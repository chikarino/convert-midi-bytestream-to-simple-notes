# MIDITONES Score Converter | MIDITONES æ¨‚è­œè½‰æ›å™¨

Convert [MIDITONES](https://github.com/LenShustek/miditones)-generated bytestream into a simple Note array for embedded systems.

å°‡ [MIDITONES](https://github.com/LenShustek/miditones) ç”Ÿæˆçš„ bytestream è½‰æ›ç‚ºç°¡å–®çš„éŸ³ç¬¦é™£åˆ—ï¼Œé©ç”¨æ–¼åµŒå…¥å¼ç³»çµ±ã€‚

## Overview | æ¦‚è¿°

This tool converts MIDITONES binary bytestream (stored in C `score[]` arrays) into a human-readable and easily-usable `Note` structure array containing frequency (Hz) and duration (frames).

æ­¤å·¥å…·å°‡ MIDITONES äºŒé€²åˆ¶ bytestreamï¼ˆå„²å­˜åœ¨ C èªè¨€çš„ `score[]` é™£åˆ—ä¸­ï¼‰è½‰æ›ç‚ºæ˜“è®€ä¸”æ˜“ç”¨çš„ `Note` çµæ§‹é™£åˆ—ï¼ŒåŒ…å«é »ç‡ï¼ˆHzï¼‰å’ŒæŒçºŒæ™‚é–“ï¼ˆå¹€æ•¸ï¼‰ã€‚

## Features | åŠŸèƒ½ç‰¹é»

- âœ… Parse MIDITONES bytestream format | è§£æ MIDITONES bytestream æ ¼å¼
- âœ… Support 'Pt' header detection | æ”¯æ´ 'Pt' æ¨™é ­åµæ¸¬
- âœ… Convert MIDI notes to Hz frequencies | å°‡ MIDI éŸ³ç¬¦è½‰æ›ç‚º Hz é »ç‡
- âœ… Frame-based timing (configurable FPS) | åŸºæ–¼å¹€æ•¸çš„æ™‚é–“ï¼ˆå¯é…ç½® FPSï¼‰
- âœ… Automatic input file detection | è‡ªå‹•åµæ¸¬è¼¸å…¥æª”æ¡ˆ
- âœ… Bilingual output comments | é›™èªè¼¸å‡ºè¨»è§£

## Requirements | ç³»çµ±éœ€æ±‚

- Python 3.7 or higher | Python 3.7 æˆ–æ›´é«˜ç‰ˆæœ¬
- No external dependencies | ç„¡éœ€å¤–éƒ¨ä¾è³´

## Installation | å®‰è£

```bash
git clone https://github.com/yourusername/miditones-converter.git
cd miditones-converter
```

## Usage | ä½¿ç”¨æ–¹å¼

### Basic Usage | åŸºæœ¬ç”¨æ³•

```bash
# Auto-detect score.c and output to song.c
# è‡ªå‹•åµæ¸¬ score.c ä¸¦è¼¸å‡ºåˆ° song.c
python convert.py

# Specify input and output files
# æŒ‡å®šè¼¸å…¥å’Œè¼¸å‡ºæª”æ¡ˆ
python convert.py -i my_score.c -o my_song.c
```

### Command Line Options | å‘½ä»¤åˆ—é¸é …

| Option | Description | èªªæ˜ |
|--------|-------------|------|
| `-i`, `--input` | Input .c file (default: auto-find score.c) | è¼¸å…¥ .c æª”ï¼ˆé è¨­è‡ªå‹•å°‹æ‰¾ score.cï¼‰ |
| `-o`, `--output` | Output .c filename (default: song.c) | è¼¸å‡º .c æª”åï¼ˆé è¨­ song.cï¼‰ |
| `--tone` | Tone generator to extract (default: 0) | è¦æŠ½å–çš„ tone generatorï¼ˆé è¨­ 0ï¼‰ |
| `--fps` | Output frame rate (default: 60) | è¼¸å‡ºå¹€ç‡ï¼ˆé è¨­ 60ï¼‰ |

### Examples | ç¯„ä¾‹

```bash
# Convert with custom frame rate
# ä½¿ç”¨è‡ªå®šç¾©å¹€ç‡è½‰æ›
python convert.py --fps 30

# Extract specific tone generator
# æŠ½å–ç‰¹å®šçš„ tone generator
python convert.py --tone 1
```

## Workflow | å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MIDI File  â”‚ â”€â”€â–¶ â”‚   MIDITONES   â”‚ â”€â”€â–¶ â”‚  score.c    â”‚ â”€â”€â–¶ â”‚   song.c    â”‚
â”‚  (.mid)     â”‚     â”‚   Compiler    â”‚     â”‚ (bytestream)â”‚     â”‚ (Note array)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                          This tool | æœ¬å·¥å…·
```

## Output Format | è¼¸å‡ºæ ¼å¼

The converter generates a C file with the following structure:

è½‰æ›å™¨ç”Ÿæˆä»¥ä¸‹çµæ§‹çš„ C æª”æ¡ˆï¼š

```c
typedef struct { uint16_t frequency; uint16_t duration; } Note;

const Note song[] = {
    { 294, 468 },  // D4, ~7.800s
    { 262, 6 },    // C4, ~0.100s
    { 0, 30 },     // Rest | ä¼‘æ­¢ç¬¦ ~0.500s
    // ...
};
const unsigned song_len = sizeof(song)/sizeof(song[0]);
```

## MIDITONES Bytestream Format | MIDITONES Bytestream æ ¼å¼

| Byte | Description | èªªæ˜ |
|------|-------------|------|
| `'P','t'` | Header signature | æ¨™é ­è­˜åˆ¥ç¢¼ |
| `0x9t nn` | Note on (tone t, note nn) | éŸ³ç¬¦é–‹å§‹ |
| `0x8t` | Note off (tone t) | éŸ³ç¬¦çµæŸ |
| `0xCt ii` | Program change | æ¨‚å™¨è®Šæ›´ |
| `0xF0` | End of score | æ¨‚è­œçµæŸ |
| `bb bb` | Delay (15-bit ms, big-endian) | å»¶é²æ™‚é–“ |

## Use Cases | æ‡‰ç”¨å ´æ™¯

- ğŸµ **Embedded Music Players** - Play music on microcontrollers (Arduino, STM32, etc.)
  
  **åµŒå…¥å¼éŸ³æ¨‚æ’­æ”¾å™¨** - åœ¨å¾®æ§åˆ¶å™¨ä¸Šæ’­æ”¾éŸ³æ¨‚ï¼ˆArduinoã€STM32 ç­‰ï¼‰

- ğŸ”” **Buzzer/Speaker Drivers** - Drive piezo buzzers or small speakers
  
  **èœ‚é³´å™¨/æšè²å™¨é©…å‹•** - é©…å‹•å£“é›»èœ‚é³´å™¨æˆ–å°å‹æšè²å™¨

- ğŸ® **Game Sound Effects** - Add music to embedded games
  
  **éŠæˆ²éŸ³æ•ˆ** - ç‚ºåµŒå…¥å¼éŠæˆ²æ·»åŠ éŸ³æ¨‚

## Related Projects | ç›¸é—œå°ˆæ¡ˆ

- [MIDITONES](https://github.com/LenShustek/miditones) - Original MIDI to bytestream converter

## Acknowledgments | è‡´è¬

- Thanks to [Len Shustek](https://github.com/LenShustek) for creating MIDITONES
- æ„Ÿè¬ [Len Shustek](https://github.com/LenShustek) å‰µå»º MIDITONES
